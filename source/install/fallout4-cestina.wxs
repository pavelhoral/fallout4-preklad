<?xml version="1.0" encoding="UTF-8"?>
<?define ProductName="Fallout 4 - Čeština" ?>
<?ifndef ProductVersion ?><?define ProductVersion="0.0.1" ?><?endif ?>
<?define ProductUrl="https://prekladyher.eu/preklady/fallout-4.79/" ?>
<?define Manufacturer="prekladyher.eu" ?>
<?define SourceBase="../../target" ?>
<?define UpgradeCode="34157A8C-584D-4A70-B4D4-3D11D419F54E" ?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
    <Product Id="*" UpgradeCode="$(var.UpgradeCode)"
            Name="$(var.ProductName)" Manufacturer="$(var.ProductName)"
            Language="1033" Codepage="1250" Version="$(var.ProductVersion)">

        <!-- Basic package configuration -->
        <Package Id="*" InstallerVersion="400"
                Manufacturer="$(var.Manufacturer)" Description="$(var.ProductName)"
                Languages="1033" Compressed="yes" SummaryCodepage="1250" />
        <MediaTemplate EmbedCab="yes" />

        <!-- Product upgrade configuration -->
        <Upgrade Id="$(var.UpgradeCode)">
            <UpgradeVersion OnlyDetect="no" Property="PREVIOUSFOUND"
                    Maximum="$(var.ProductVersion)" IncludeMaximum="no" />
        </Upgrade>

        <!-- Lookup game directory -->
        <Property Id="INSTALLDIR">
            <RegistrySearch Id="Fallout4Registry" Root="HKLM" Type="directory"
                    Key="SOFTWARE\WOW6432Node\Bethesda Softworks\Fallout4" Name="installed path" />
        </Property>
        <Condition Message="Nebylo možné najít složku Fallout 4.">
            <![CDATA[Installed OR INSTALLDIR]]>
        </Condition>

        <!-- Lookup game configuration -->
        <Property Id="FALLOUTPERSONAL">
            <DirectorySearch Id="FalloutPersonal" Path="[PersonalFolder]\My Games\Fallout4" AssignToProperty="yes" />
        </Property>
        <Property Id="FALLOUTCONFIG">
            <DirectorySearch Id="FalloutPersonal" Path="[FALLOUTPERSONAL]">
                <FileSearch Id="Fallout4Custom.ini" Name="Fallout4Custom.ini" />
            </DirectorySearch>
        </Property>
        <Condition Message="Nebylo možné najít soubor Fallout4Custom.ini (hru je nutné před instalací češtiny alespoň jednou spustit).">
            <![CDATA[Installed OR FALLOUTCONFIG]]>
        </Condition>

        <!-- Define target structure -->
        <Directory Id="TARGETDIR" Name="SourceDir">
            <Directory Id="INSTALLDIR" Name="Fallout4">
                <Directory Id="DataDir" Name="Data">
                    <Directory Id="InterfaceDir" Name="Interface" />
                    <Directory Id="StringsDir" Name="Strings" />
                </Directory>
            </Directory>
        </Directory>

        <!-- Default components and feature -->
        <DirectoryRef Id="TARGETDIR">
            <Component Id="Fallout4Custom.ini" Guid="9AE43969-D7CB-495C-ABB1-007E289E2579" KeyPath="yes" Permanent="yes">
                <IniFile Id="Fallout4Custom.ini" Directory="FALLOUTPERSONAL" Name="Fallout4Custom.ini"
                        Action="addLine" Section="Archive" Key="bInvalidateOlderFiles" Value="1" />
            </Component>
        </DirectoryRef>
        <DirectoryRef Id="InterfaceDir" FileSource="$(var.SourceBase)/interface">
            <Component Id="FalloutDict.txt" Guid="12EFF6F4-D4B3-46DE-B19D-8ECC9C14E2FD">
                <File Id="FalloutDict.txt" KeyPath="yes" />
            </Component>
            <Component Id="fonts_console.swf" Guid="FE877870-B4EE-4BCC-8629-4BF416304551">
                <File Id="fonts_console.swf" KeyPath="yes" />
            </Component>
            <Component Id="fonts_en.swf" Guid="7207CCFC-D1FE-455B-885F-C2B2D5C621A0">
                <File Id="fonts_en.swf" KeyPath="yes" />
            </Component>
            <Component Id="Translate_en.txt" Guid="DCAEE1F0-201B-438B-84B1-8473A3F79B04">
                <File Id="Translate_en.txt" KeyPath="yes" />
            </Component>
        </DirectoryRef>
        <DirectoryRef Id="StringsDir" FileSource="$(var.SourceBase)/strings">
            <Component Id="Fallout4_en.STRINGS" Guid="4B12370A-B699-4B52-8F83-C697C36920A5">
                <File Id="Fallout4_en.STRINGS" KeyPath="yes" />
            </Component>
            <Component Id="Fallout4_en.ILSTRINGS" Guid="77898D90-8E42-4706-9957-8213DC573A0B">
                <File Id="Fallout4_en.ILSTRINGS" KeyPath="yes" />
            </Component>
            <Component Id="Fallout4_en.DLSTRINGS" Guid="226CD62C-D2CA-4DF2-9798-4FE1DD22AEB1">
                <File Id="Fallout4_en.DLSTRINGS" KeyPath="yes" />
            </Component>
        </DirectoryRef>
        <DirectoryRef Id="INSTALLDIR" FileSource="$(var.SourceBase)">
            <Component Id="Fallout4_Cestina.html" Guid="E286B976-38E7-46C9-9A35-D78C23CAECE6">
                <File Id="Fallout4_Cestina.html" KeyPath="yes" />
            </Component>
            <Component Id="Fallout4_Cestina.png" Guid="0EBBD798-6B00-49CF-BCFB-7C4A4D8DC68F">
                <File Id="Fallout4_Cestina.png" KeyPath="yes" />
            </Component>
        </DirectoryRef>
        <Feature Id="DefaultFeature" Level="1">
            <ComponentRef Id="FalloutDict.txt" />
            <ComponentRef Id="fonts_console.swf" />
            <ComponentRef Id="fonts_en.swf" />
            <ComponentRef Id="Translate_en.txt" />
            <ComponentRef Id="Fallout4Custom.ini" />
            <ComponentRef Id="Fallout4_en.STRINGS" />
            <ComponentRef Id="Fallout4_en.ILSTRINGS" />
            <ComponentRef Id="Fallout4_en.DLSTRINGS" />
            <ComponentRef Id="Fallout4_Cestina.html" />
            <ComponentRef Id="Fallout4_Cestina.png" />
        </Feature>

        <!-- Open README after install -->
        <Property Id="WixShellExecTarget" Value="[#Fallout4_Cestina.html]" />
        <CustomAction Id="OpenReadme" BinaryKey="WixCA" DllEntry="WixShellExec" Impersonate="yes" Return="ignore" />
        <UI>
            <Publish Dialog="ExitDialog" Control="Finish" Event="DoAction" Value="OpenReadme">NOT Installed</Publish>
        </UI>

        <!-- Custom install sequence -->
        <InstallExecuteSequence>
            <RemoveExistingProducts Before="InstallInitialize" />
        </InstallExecuteSequence>

        <!-- Define installer icon -->
          <Icon Id="Icon" SourceFile="installer-icon.ico" />

          <!-- Configure properties for add/remove programs -->
          <Property Id="ARPPRODUCTICON" Value="Icon" />
          <Property Id="ARPHELPLINK" Value="$(var.ProductUrl)" />

          <!-- Define UI properties -->
          <WixVariable Id="WixUIBannerBmp" Value="installer-banner.bmp" />
          <WixVariable Id="WixUIDialogBmp" Value="installer-header.bmp" />

        <!-- Include UI configuration -->
        <?include installer-simpleui.wxi ?>
    </Product>
</Wix>